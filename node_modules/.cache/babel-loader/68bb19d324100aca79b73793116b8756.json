{"ast":null,"code":"import _slicedToArray from \"/Users/benwang/Desktop/NYCU_CS/112spring/cloud/final/Cloudnative_Final_project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/benwang/Desktop/NYCU_CS/112spring/cloud/final/Cloudnative_Final_project/src/pages/Modify.js\";\nimport { Button, Container, Form, Header } from \"semantic-ui-react\";\nimport { useState } from \"react\";\nimport firebase from \"../utils/firebase\";\nimport React from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport \"firebase/firestore\";\nfunction Modify() {\n  var _useParams = useParams(),\n    postId = _useParams.postId,\n    versionId = _useParams.versionId;\n  var navigate = useNavigate();\n  // eslint-disable-next-line\n  var _useState = useState(\"\"),\n    _useState2 = _slicedToArray(_useState, 2),\n    content = _useState2[0],\n    setContent = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isloading = _useState4[0],\n    setIsloading = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    file = _useState6[0],\n    setFile = _useState6[1];\n  var _useState7 = useState(\"\"),\n    _useState8 = _slicedToArray(_useState7, 2),\n    title = _useState8[0],\n    setTitle = _useState8[1];\n  var _useState9 = useState(\"\"),\n    _useState10 = _slicedToArray(_useState9, 2),\n    topicName = _useState10[0],\n    setTopicName = _useState10[1];\n  var _React$useState = React.useState({\n      author: {}\n    }),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    post = _React$useState2[0],\n    setPost = _React$useState2[1];\n  React.useEffect(function () {\n    if (versionId) {\n      firebase.firestore().collection(\"posts\").doc(postId).collection(\"versions\").doc(versionId).get().then(function (docSnapshot) {\n        var data = docSnapshot.data();\n        setPost(data);\n      });\n    } else {\n      firebase.firestore().collection(\"posts\").doc(postId).get().then(function (docSnapshot) {\n        var data = docSnapshot.data();\n        setPost(data);\n      });\n    }\n  }, [postId, versionId]);\n  React.useEffect(function () {\n    setContent(post.content);\n  }, [post.content]);\n  React.useEffect(function () {\n    setTitle(post.title);\n  }, [post.title]);\n  React.useEffect(function () {\n    setTopicName(post.topic);\n  }, [post.topic]);\n  function onSubmit() {\n    setIsloading(true);\n    var documentRef = firebase.firestore().collection(\"posts\").doc(postId).collection(\"versions\").doc();\n    var fileRef = firebase.storage().ref(\"post/\" + postId + \"versions/\" + documentRef.id);\n    var metadata = {};\n    if (file !== null) {\n      metadata = {\n        contentType: file.type\n      };\n    }\n    fileRef.put(file, metadata).then(function () {\n      fileRef.getDownloadURL().then(function (imageUrl) {\n        documentRef.set({\n          topic: topicName,\n          content: content,\n          title: title,\n          cretedAt: firebase.firestore.Timestamp.now(),\n          author: {\n            display: firebase.auth().currentUser.displayName || \"Unknown\",\n            photoURL: firebase.auth().currentUser.photoURL || \"https://react.semantic-ui.com/images/avatar/large/molly.png\",\n            uid: firebase.auth().currentUser.uid,\n            email: firebase.auth().currentUser.email\n          },\n          imageUrl: imageUrl\n        }).then(function () {\n          setIsloading(false);\n          navigate(\"/\");\n        });\n      });\n    });\n  }\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Header, {\n    as: \"h1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }\n  }, \"\\u66F4\\u6539\\u6587\\u7AE0\"), /*#__PURE__*/React.createElement(Form, {\n    onSubmit: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Form.Input, {\n    value: post.title,\n    readOnly: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Form.TextArea, {\n    // placeholder={post.content}\n\n    value: content,\n    onChange: function onChange(e) {\n      return setContent(e.target.value);\n    },\n    rows: 30,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    loading: isloading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 9\n    }\n  }, \"\\u9001\\u51FA\\u66F4\\u6539\")));\n}\nexport default Modify;","map":{"version":3,"names":["Button","Container","Form","Header","useState","firebase","React","useParams","useNavigate","Modify","_useParams","postId","versionId","navigate","_useState","_useState2","_slicedToArray","content","setContent","_useState3","_useState4","isloading","setIsloading","_useState5","_useState6","file","setFile","_useState7","_useState8","title","setTitle","_useState9","_useState10","topicName","setTopicName","_React$useState","author","_React$useState2","post","setPost","useEffect","firestore","collection","doc","get","then","docSnapshot","data","topic","onSubmit","documentRef","fileRef","storage","ref","id","metadata","contentType","type","put","getDownloadURL","imageUrl","set","cretedAt","Timestamp","now","display","auth","currentUser","displayName","photoURL","uid","email","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","as","Input","value","readOnly","TextArea","onChange","e","target","rows","loading"],"sources":["/Users/benwang/Desktop/NYCU_CS/112spring/cloud/final/Cloudnative_Final_project/src/pages/Modify.js"],"sourcesContent":["import { Button, Container, Form, Header } from \"semantic-ui-react\";\r\nimport { useState } from \"react\";\r\n\r\nimport firebase from \"../utils/firebase\";\r\nimport React from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport \"firebase/firestore\";\r\n\r\nfunction Modify() {\r\n  const { postId, versionId } = useParams();\r\n  const navigate = useNavigate();\r\n  // eslint-disable-next-line\r\n  const [content, setContent] = useState(\"\");\r\n  const [isloading, setIsloading] = useState(false);\r\n  const [file, setFile] = useState(null);\r\n  const [title, setTitle] = useState(\"\");\r\n  const [topicName, setTopicName] = useState(\"\");\r\n\r\n  const [post, setPost] = React.useState({\r\n    author: {},\r\n  });\r\n  React.useEffect(() => {\r\n    if (versionId) {\r\n      firebase\r\n        .firestore()\r\n        .collection(\"posts\")\r\n        .doc(postId)\r\n        .collection(\"versions\")\r\n        .doc(versionId)\r\n        .get()\r\n        .then((docSnapshot) => {\r\n          const data = docSnapshot.data();\r\n          setPost(data);\r\n        });\r\n    } else {\r\n      firebase\r\n        .firestore()\r\n        .collection(\"posts\")\r\n        .doc(postId)\r\n        .get()\r\n        .then((docSnapshot) => {\r\n          const data = docSnapshot.data();\r\n          setPost(data);\r\n        });\r\n    }\r\n  }, [postId, versionId]);\r\n\r\n  React.useEffect(() => {\r\n    setContent(post.content);\r\n  }, [post.content]);\r\n\r\n  React.useEffect(() => {\r\n    setTitle(post.title);\r\n  }, [post.title]);\r\n\r\n  React.useEffect(() => {\r\n    setTopicName(post.topic);\r\n  }, [post.topic]);\r\n\r\n  function onSubmit() {\r\n    setIsloading(true);\r\n\r\n    const documentRef = firebase\r\n      .firestore()\r\n      .collection(\"posts\")\r\n      .doc(postId)\r\n      .collection(\"versions\")\r\n      .doc();\r\n\r\n    const fileRef = firebase\r\n      .storage()\r\n      .ref(\"post/\" + postId + \"versions/\" + documentRef.id);\r\n\r\n    let metadata = {};\r\n    if (file !== null) {\r\n      metadata = {\r\n        contentType: file.type,\r\n      };\r\n    }\r\n\r\n    fileRef.put(file, metadata).then(() => {\r\n      fileRef.getDownloadURL().then((imageUrl) => {\r\n        documentRef\r\n          .set({\r\n            topic: topicName,\r\n            content,\r\n            title,\r\n            cretedAt: firebase.firestore.Timestamp.now(),\r\n            author: {\r\n              display: firebase.auth().currentUser.displayName || \"Unknown\",\r\n              photoURL:\r\n                firebase.auth().currentUser.photoURL ||\r\n                \"https://react.semantic-ui.com/images/avatar/large/molly.png\",\r\n              uid: firebase.auth().currentUser.uid,\r\n              email: firebase.auth().currentUser.email,\r\n            },\r\n            imageUrl,\r\n          })\r\n          .then(() => {\r\n            setIsloading(false);\r\n            navigate(\"/\");\r\n          });\r\n      });\r\n    });\r\n  }\r\n\r\n  return (\r\n    <Container>\r\n      <Header as=\"h1\">更改文章</Header>\r\n      <Form onSubmit={onSubmit}>\r\n        <Form.Input value={post.title} readOnly />\r\n        <Form.TextArea\r\n          // placeholder={post.content}\r\n\r\n          value={content}\r\n          onChange={(e) => setContent(e.target.value)}\r\n          rows={30}\r\n        />\r\n        {/* <Image src={post.imageUrl} size=\"small\" floated=\"left\" /> */}\r\n        <Button loading={isloading}>送出更改</Button>\r\n      </Form>\r\n    </Container>\r\n  );\r\n}\r\n\r\nexport default Modify;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}