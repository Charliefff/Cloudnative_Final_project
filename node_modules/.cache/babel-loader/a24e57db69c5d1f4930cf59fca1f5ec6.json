{"ast":null,"code":"import _slicedToArray from \"/Users/benwang/Desktop/NYCU_CS/112spring/cloud/final/Cloudnative_Final_project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/benwang/Desktop/NYCU_CS/112spring/cloud/final/Cloudnative_Final_project/src/pages/New_post.js\";\nimport { Container, Header, Form, Button } from \"semantic-ui-react\";\nimport React from \"react\";\nimport { useState } from \"react\";\nimport \"firebase/compat/firestore\";\nimport firebase from \"../utils/firebase\";\nimport { useNavigate } from \"react-router-dom\";\nimport \"firebase/compat/storage\";\nfunction New_Post() {\n  var navigate = useNavigate();\n  var _useState = useState(\"\"),\n    _useState2 = _slicedToArray(_useState, 2),\n    title = _useState2[0],\n    setTitle = _useState2[1];\n  var _useState3 = useState(\"\"),\n    _useState4 = _slicedToArray(_useState3, 2),\n    content = _useState4[0],\n    setContent = _useState4[1];\n  var _useState5 = useState([]),\n    _useState6 = _slicedToArray(_useState5, 2),\n    topics = _useState6[0],\n    setTopics = _useState6[1];\n  var _useState7 = useState(\"\"),\n    _useState8 = _slicedToArray(_useState7, 2),\n    topicName = _useState8[0],\n    setTopicName = _useState8[1];\n  var _useState9 = useState(null),\n    _useState10 = _slicedToArray(_useState9, 2),\n    file = _useState10[0],\n    setFile = _useState10[1];\n  var _useState11 = useState(false),\n    _useState12 = _slicedToArray(_useState11, 2),\n    isloading = _useState12[0],\n    setIsloading = _useState12[1];\n  React.useEffect(function () {\n    firebase.firestore().collection(\"topics\").get().then(function (collectionSnapshot) {\n      var data = collectionSnapshot.docs.map(function (doc) {\n        return doc.data();\n      });\n      // console.log(data);\n      setTopics(data);\n    });\n  }, []);\n  var options = topics.map(function (topic) {\n    return {\n      text: topic.name,\n      value: topic.name\n    };\n  });\n  // eslint-disable-next-line\n  // const preview = file\n  //   ? URL.createObjectURL(file)\n  //   : \"https://react.semantic-ui.com/images/wireframe/image.png\";\n\n  function onSubmit() {\n    setIsloading(true);\n    var documentRef = firebase.firestore().collection(\"posts\").doc();\n    var fileRef = firebase.storage().ref(\"post/\" + documentRef.id);\n    // 可能有bug\n    var metadata = {};\n    if (file !== null) {\n      metadata = {\n        contentType: file.type\n      };\n    }\n    fileRef.put(file, metadata).then(function () {\n      fileRef.getDownloadURL().then(function (imageUrl) {\n        documentRef.set({\n          topic: topicName,\n          content: content,\n          title: title,\n          cretedAt: firebase.firestore.Timestamp.now(),\n          author: {\n            display: firebase.auth().currentUser.displayName || \"Unknown\",\n            photoURL: firebase.auth().currentUser.photoURL || \"https://react.semantic-ui.com/images/avatar/large/molly.png\",\n            uid: firebase.auth().currentUser.uid,\n            email: firebase.auth().currentUser.email\n          },\n          imageUrl: imageUrl\n        }).then(function () {\n          setIsloading(false);\n          navigate(\"/\");\n        });\n      });\n    });\n  }\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Header, {\n    as: \"h1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 9\n    }\n  }, \"New Post\")), /*#__PURE__*/React.createElement(Form, {\n    onSubmit: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Form.Input, {\n    type: \"file\",\n    width: 6,\n    id: \"post-image\",\n    style: {\n      display: \"None\"\n    },\n    onChange: function onChange(e) {\n      setFile(e.target.files[0]);\n      console.log(e.target.files[0]);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Form.Input, {\n    placeholder: \"\\u6587\\u7AE0\\u6A19\\u984C\",\n    value: title,\n    onChange: function onChange(e) {\n      return setTitle(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Form.TextArea, {\n    placeholder: \"\\u6587\\u7AE0\\u5167\\u5BB9\",\n    value: content,\n    onChange: function onChange(e) {\n      return setContent(e.target.value);\n    },\n    rows: 30,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Form.Dropdown, {\n    placeholder: \"\\u6587\\u7AE0\\u5206\\u985E\",\n    options: options,\n    value: topicName,\n    onChange: function onChange(e, _ref) {\n      var value = _ref.value;\n      return setTopicName(value);\n    },\n    selection: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    as: \"label\",\n    htmlFor: \"post-image\",\n    basic: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 11\n    }\n  }, \"\\u4E0A\\u50B3\\u5716\\u7247\"), /*#__PURE__*/React.createElement(Button, {\n    loading: isloading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 11\n    }\n  }, \"\\u767C\\u5E03\\u6587\\u7AE0\"))));\n}\nexport default New_Post;","map":{"version":3,"names":["Container","Header","Form","Button","React","useState","firebase","useNavigate","New_Post","navigate","_useState","_useState2","_slicedToArray","title","setTitle","_useState3","_useState4","content","setContent","_useState5","_useState6","topics","setTopics","_useState7","_useState8","topicName","setTopicName","_useState9","_useState10","file","setFile","_useState11","_useState12","isloading","setIsloading","useEffect","firestore","collection","get","then","collectionSnapshot","data","docs","map","doc","options","topic","text","name","value","onSubmit","documentRef","fileRef","storage","ref","id","metadata","contentType","type","put","getDownloadURL","imageUrl","set","cretedAt","Timestamp","now","author","display","auth","currentUser","displayName","photoURL","uid","email","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","as","Input","width","style","onChange","e","target","files","console","log","placeholder","TextArea","rows","Dropdown","_ref","selection","htmlFor","basic","loading"],"sources":["/Users/benwang/Desktop/NYCU_CS/112spring/cloud/final/Cloudnative_Final_project/src/pages/New_post.js"],"sourcesContent":["import { Container, Header, Form, Button } from \"semantic-ui-react\";\r\nimport React from \"react\";\r\nimport { useState } from \"react\";\r\nimport \"firebase/compat/firestore\";\r\nimport firebase from \"../utils/firebase\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport \"firebase/compat/storage\";\r\n\r\nfunction New_Post() {\r\n  const navigate = useNavigate();\r\n  const [title, setTitle] = useState(\"\");\r\n  const [content, setContent] = useState(\"\");\r\n  const [topics, setTopics] = useState([]);\r\n  const [topicName, setTopicName] = useState(\"\");\r\n  const [file, setFile] = useState(null);\r\n  const [isloading, setIsloading] = useState(false);\r\n\r\n  React.useEffect(() => {\r\n    firebase\r\n      .firestore()\r\n      .collection(\"topics\")\r\n      .get()\r\n      .then((collectionSnapshot) => {\r\n        const data = collectionSnapshot.docs.map((doc) => {\r\n          return doc.data();\r\n        });\r\n        // console.log(data);\r\n        setTopics(data);\r\n      });\r\n  }, []);\r\n\r\n  const options = topics.map((topic) => {\r\n    return {\r\n      text: topic.name,\r\n      value: topic.name,\r\n    };\r\n  });\r\n  // eslint-disable-next-line\r\n  // const preview = file\r\n  //   ? URL.createObjectURL(file)\r\n  //   : \"https://react.semantic-ui.com/images/wireframe/image.png\";\r\n\r\n  function onSubmit() {\r\n    setIsloading(true);\r\n    const documentRef = firebase\r\n      .firestore()\r\n      .collection(\"posts\")\r\n      .doc();\r\n    const fileRef = firebase.storage().ref(\"post/\" + documentRef.id);\r\n    // 可能有bug\r\n    let metadata = {};\r\n    if (file !== null) {\r\n      metadata = {\r\n        contentType: file.type,\r\n      };\r\n    }\r\n\r\n    fileRef.put(file, metadata).then(() => {\r\n      fileRef.getDownloadURL().then((imageUrl) => {\r\n        documentRef\r\n          .set({\r\n            topic: topicName,\r\n            content,\r\n            title,\r\n            cretedAt: firebase.firestore.Timestamp.now(),\r\n            author: {\r\n              display: firebase.auth().currentUser.displayName || \"Unknown\",\r\n              photoURL:\r\n                firebase.auth().currentUser.photoURL ||\r\n                \"https://react.semantic-ui.com/images/avatar/large/molly.png\",\r\n              uid: firebase.auth().currentUser.uid,\r\n              email: firebase.auth().currentUser.email,\r\n            },\r\n            imageUrl,\r\n          })\r\n          .then(() => {\r\n            setIsloading(false);\r\n            navigate(\"/\");\r\n          });\r\n      });\r\n    });\r\n  }\r\n\r\n  return (\r\n    <Container>\r\n      <div>\r\n        <Header as=\"h1\">New Post</Header>\r\n      </div>\r\n      <Form onSubmit={onSubmit}>\r\n        <Form.Input\r\n          type=\"file\"\r\n          width={6}\r\n          id=\"post-image\"\r\n          style={{ display: \"None\" }}\r\n          onChange={(e) => {\r\n            setFile(e.target.files[0]);\r\n            console.log(e.target.files[0]);\r\n          }}\r\n        />\r\n        <Form.Input\r\n          placeholder=\"文章標題\"\r\n          value={title}\r\n          onChange={(e) => setTitle(e.target.value)}\r\n        />\r\n\r\n        <Form.TextArea\r\n          placeholder=\"文章內容\"\r\n          value={content}\r\n          onChange={(e) => setContent(e.target.value)}\r\n          rows={30}\r\n        />\r\n\r\n        <Form.Dropdown\r\n          placeholder=\"文章分類\"\r\n          options={options}\r\n          value={topicName}\r\n          onChange={(e, { value }) => setTopicName(value)}\r\n          selection\r\n        />\r\n        <div>\r\n          <Button as=\"label\" htmlFor=\"post-image\" basic>\r\n            上傳圖片\r\n          </Button>\r\n          <Button loading={isloading}>發布文章</Button>\r\n        </div>\r\n\r\n        {/* <div>\r\n          <Form.Button loading={isloading}>Submit</Form.Button>\r\n          <Form.Button basic as=\"label\" htmlFor=\"post-image\">\r\n            上傳檔案\r\n          </Form.Button>\r\n        </div> */}\r\n      </Form>\r\n    </Container>\r\n  );\r\n}\r\n\r\nexport default New_Post;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}